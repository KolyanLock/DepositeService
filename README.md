# UserDepositeService

Сервис для управления пользовательскими депозитами с использованием Spring Boot, PostgreSQL и Elasticsearch.
Это ветка с транзакциями для идемпотентности операций по переводам (не путайте с транзакциями БД). 
Упрощённая версия без транзакций в ветке **simplified-version-1**.

## Требования
- Java 21
- Maven 3.9.x
- Docker + Docker Compose (Docker Desktop будет достаточно)

## Настройка
1. Создайте `.env` файл в корне проекта:

    ```properties
    DB_USER=postgres_логин
    DB_PASSWORD=postgres_пароль
    ES_PASSWORD=elastic_пароль
    ```

2. Создайте файл `src/main/resources/secret/secret.properties`. 
Свойства должны совпадать с `.env`. 
`JWT_SECRET` - необязательный дополнительный параметр, 
если не задать будет использоваться дефолтное значение, но это не безопасно. 
Можно также задать эти свойства как переменные окружения в конфигурации запуска IDEA.
   ```properties
    DB_USER=postgres_логин
    DB_PASSWORD=postgres_пароль
    ES_PASSWORD=elastic_пароль
    JWT_SECRET=jwt_секрет
    ```

3. Запустите контейнеры с PostgreSQL и Elasticsearch
    ```bash
    docker-compose up -d
    ```

4. Сборка приложения: 
   - сборка и запуск тестов
       ```bash
       mvn clean package
       ```
   - быстрая сборка с пропуском тестов
     ```bash
     mvn clean package -DskipTests
     ```

5. Запуск jar-файла приложения:
    ```bash
    java -jar target/UserDepositeService-0.0.1-SNAPSHOT.jar
    ```
## Swagger UI
 - После запуска сервиса доступен Swagger UI по адресу:  
   <http://localhost:8080/swagger-ui/index.html>
 - Данные пользователей можно посмотреть в файле:  
   `src/main/resources/sql/init_user_data.sql`



## Пояснение
Для того чтобы правильно работал планировщик пополнения баланса при запуске
нескольких экземпляров сервиса понадобиться настроить Quartz Job Scheduler для небольшого 
количества одновременно запущенных экземпляров или Redis + Scheduled Lock
для большого количества экземпляров. Готов реализовать, если требуется.

## Вопросы к техническому заданию
1. Если пополнение баланса осуществляется с определённым лимитом в процентах от баланса, 
то что делать когда средства переводят или списывают? Я придумал собственную логику, готов описать.
2. Требуется ли сделать запуск jar-файла сразу через docker-compose в контейнере? Готов сделать, если надо.